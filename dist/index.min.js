!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.BubbleValidator=e()}(this,function(){"use strict";function i(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var n=["INPUT","TEXTAREA","SELECT"],c=["required","length","min","max","pattern","custom"],e=["$fields","invalid","valid","untouched","touched","pristine","dirty","modified"],a=["required"],s={invalid:!1,valid:!0,untouched:!0,touched:!1,pristine:!0,dirty:!1,modified:!1},u={COMMONFORM:Symbol("COMMONFORM"),CHECKRADIO:Symbol("CHECKRADIO"),NONFORM:Symbol("NONFORM")};function v(t){return Object.prototype.toString.call(t).match(/\[object\s([^]+)\]/)[1].toLowerCase()}function f(t,e){return 0<=t.indexOf(e)}function h(t){throw Error("[BubbleValidator] Error: ".concat(t))}function m(t){console.warn("[BubbleValidator] Warning: ".concat(t))}function $(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return String(t).replace(/\-([A-Za-z])/g,function(t,e){return e.toUpperCase()})}function p(t){return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return t=t.toUpperCase(),f(n,t)}(t.tagName)?"INPUT"===(e=t).tagName.toUpperCase()&&["checkbox","radio"].includes(e.type)?u.CHECKRADIO:u.COMMONFORM:u.NONFORM;var e}function b(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=t.elm,n=t.data.attrs||{},a=n.name||n["data-name"]||i.getAttribute("name")||i.dataset.name;return e&&!a&&h('You must specify a "name" attribute for the validation field'),a}function y(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=null,a=t.data.directives,r=!0,o=!1,d=void 0;try{for(var l,u=a[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;if(c.name===e){n=c;break}}}catch(t){o=!0,d=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw d}}return n&&i?n.modifiers[i]?n:null:n}function l(t,e){return!(void 0!==e||!f(a,t))||e}var O={};function g(t){var e=t.$name;t.$value===t.$origin?(t.pristine=!0,t.modified=!1):(t.pristine=!1,t.modified=!0,t.dirty=!0),this.checkValidity(e)}function M(t){t.untouched&&(t.untouched=!1,t.touched=!0),g.call(this,t)}function x(t,e){var i=e.$element,n=p(i);switch(n){case u.CHECKRADIO:e.$watcher=this.$watch(e.$expression,M.bind(this,e));break;case u.COMMONFORM:e.$watcher=this.$watch(e.$expression,g.bind(this,e));break;case u.NONFORM:e.$watcher=this.$watch(e.$expression,M.bind(this,e))}var a=t.componentInstance,r=void 0!==a;if(n===u.COMMONFORM||r){var o=function(t){var e=t.$name;t.untouched&&(t.untouched=!1,t.touched=!0),this.checkValidity(e)}.bind(this,e),d=function(i){Object.assign(i,s),N.call(this),i.$handlers.forEach(function(t){var e=t.$directive;i[e]=!1})}.bind(this,e),l=O[e.$name]=O[e.$name]||[];n===u.COMMONFORM?(i.addEventListener("blur",o),i.addEventListener("focus",d),l.push(function(){return i.removeEventListener("blur",o)}),l.push(function(){return i.removeEventListener("focus",d)})):r&&(a.$on("blur",o),a.$on("focus",d),l.push(function(){return a.$off("blur",o)}),l.push(function(){return a.$off("focus",d)}))}}function N(){Object.assign(this.validation,{untouched:!0,touched:!0,modified:!1,dirty:!1,pristine:!0,invalid:!1,valid:!0});var i=this.validation;i.$fields.forEach(function(t){var e=i[t];!1===e.untouched&&(i.untouched=!1),!0===e.untouched&&(i.touched=!1),!0===e.modified&&(i.modified=!0),!0===e.dirty&&(i.dirty=!0),!1===e.pristine&&(i.pristine=!1),!0===e.invalid&&(i.invalid=!0),!1===e.valid&&(i.valid=!1)})}var r={ISO_DATE:/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,URL:/^[a-z]+:\/\/(?:[\w-]+\.)+[a-z]{2,6}.*$/i,EMAIL:/^[\w-\.]+@(?:[\w-]+\.)+[a-z]{2,6}$/i,NUMBER:/^[\d]+$/i,DATE:/^(\d{4})-(\d{2})-(\d{2})$/,TIME:/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/},w={required:function(t,e){return"false"===e||!e||("array"===v(t)?0<t.length:"object"===v(t)?0<Object.keys(t).length:0===t||!!t)},type:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=r[e.toUpperCase()];return i?i.test(t):(m('v-type="'.concat(e,'" does not match any rules so it will be ignored')),!0)},length:function(t,e){return String(t).length===parseInt(e)},minLength:function(t,e){return String(t).length>=parseInt(e)},maxLength:function(t,e){return String(t).length<=parseInt(e)},min:function(t,e){return e=parseFloat(e),!!isNaN(e)||(null==t||""===t||e<=+t)},max:function(t,e){return e=parseFloat(e),!!isNaN(e)||(null==t||""===t||+t<=e)},pattern:function(t,e){return"string"==typeof e&&(e=new RegExp(e)),e.test(t||"")},custom:function(t,e){return e}},C={required:1,type:2,length:3,minLength:4,maxLength:5,min:6,max:7,pattern:100,custom:200};function E(t){f(e,t)&&h('Name "'.concat(t,'" is a preserved word, please use other field names instead.'))}function R(t,e,i){if(!t.dataset.bubbleBound){var n=b(i);E(n);var a,r,o=$(e.name),d="model"===o&&e.modifiers.validator||"validator"===o?e:((r=y(a=i,"model","validator"))||(r=y(a,"validator")),r);if(d){var l=i.context,u=l.validation[n];return"model"===o&&u&&u.$name&&t!==u.$element&&h("Duplicated validation field name: ".concat(n)),u||function(t,e,i,n){var a=e.elm;this.validation[t]||(this.$set(this.validation,t,Object.assign({},s)),Object.assign(this.validation[t],{$name:t,$handlers:[],$element:a,$expression:n,$origin:i,$value:i,$oldVal:i}));var r=this.validation[t];x.call(this,e,r),f(this.validation.$fields,t)||this.validation.$fields.push(t)}.call(l,n,i,d.value,d.expression),t.dataset.bubbleBound=!0,n}f(c,o)&&m('Field "'.concat(n,"\" lacks of '.validator' modifier for form elements or 'v-validator' directive\n")+"for non-form elements, all validation rules will be ignore.")}}function o(t,e,i){var n=i.context,a=b(i,!1);if(a){var r=n.validation[a];r.$inited&&e.value===e.oldValue||(r.$oldVal=e.oldValue,r.$value=e.value,r.$inited||(r.$inited=!0))}}function d(t,e,i){var n=b(i,!1);if(n){var a=i.context;(function(t){var e=this.validation,i=e.$fields.indexOf(t);if(!(i<0)){e.$fields.splice(i,1);var n=e[t],a=n.$element,r=n.$watcher,o=n.$related;"function"==typeof r&&r(),"function"==typeof o&&o();var d=p(a),l=O[n.$name];if(d===u.COMMONFORM&&"array"===v(l)){for(;l.length;)l.shift()();O[n.$name]=null}this.$delete(e,t),N.call(this)}}).call(a,n)}}function V(){return{bind:function(t,e,i,n){var a=R(t,e,i);if(a){var r=i.context,o=$(e.name),d=l(o,e.value);(function(t,e){var i=this.validation[t],n=i.$handlers,a=n.map(function(t){return t.$directive}),r=e.$directive;f(a,r)||(this.$set(i,r,!1),n.push(e),n.sort(function(t,e){return t.$priority-e.$priority}))}).call(r,a,{$priority:C[o],$directive:o,$directiveVal:d,$handler:w[o]})}},update:function(t,e,i){var n=i.context,a=$(e.name),r=b(i,!1);if(r&&n.validation[r]){var o=function(t,e){var i=null,n=!0,a=!1,r=void 0;try{for(var o,d=t[Symbol.iterator]();!(n=(o=d.next()).done);n=!0){var l=o.value;if(l.$directive===e){i=l;break}}}catch(t){a=!0,r=t}finally{try{n||null==d.return||d.return()}finally{if(a)throw r}}return i}(n.validation[r].$handlers,a);o&&(o.$directiveVal=l(a,e.value))}}}}function F(){var t={};t.model={bind:R,componentUpdated:o,unbind:d},t.validator={bind:R,componentUpdated:o,unbind:d},t.related={bind:function(t,e,i,n){var a=R(t,e,i);if(a){var r=i.context;(function(t,e){var i=this;t.$related=this.$watch(e,function(){i.checkValidity(t.$name)})}).call(r,r.validation[a],e.expression)}}};for(var e=Object.keys(w),i=0;i<e.length;i++){t[e[i]]=V()}return t}return function(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{data:function(){return{validation:Object.assign({},s)}},created:function(){this.validation&&(this.validation.$fields=[])},methods:(t={},i(t,(e=Object.assign({accessor:"v"},e)).accessor,function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"invalid",i=this.validation||{};return i[t]&&i[t][e]}),i(t,"resetValidation",function(){}),i(t,"checkValidity",function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(t){var i=this.validation[t],n=i.$value,a=i.$handlers||[],r=!(i.invalid=!1),o=!1,d=void 0;try{for(var l,u=a[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;i.invalid&&(i[c.$directive]=!1);var s=c.$handler(n,c.$directiveVal);"custom"===c.$directive?(this.$set(i,"customCode",c.$directiveVal),i[c.$directive]=!0!==c.$directiveVal):i[c.$directive]=!s,s||(i.invalid=!0)}}catch(t){o=!0,d=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw d}}i.valid=!i.invalid}else{var v=this.validation.$fields||[],f=!0,h=!1,m=void 0;try{for(var $,p=v[Symbol.iterator]();!(f=($=p.next()).done);f=!0){var b=$.value;this.checkValidity(b,!0)}}catch(t){h=!0,m=t}finally{try{f||null==p.return||p.return()}finally{if(h)throw m}}}!e&&N.call(this)}),t),directives:F()}}});
