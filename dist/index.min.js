!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.BubbleValidator=e()}(this,function(){"use strict";function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var i=["INPUT","TEXTAREA","SELECT"],u=["required","length","min","max","pattern","custom"],e=["$fields","invalid","valid","untouched","touched","pristine","dirty","modified"],n=["required"],o={invalid:!1,valid:!0,untouched:!0,touched:!1,pristine:!0,dirty:!1,modified:!1},l={COMMONFORM:Symbol("COMMONFORM"),CHECKRADIO:Symbol("CHECKRADIO"),NONFORM:Symbol("NONFORM")};function r(t){return Object.prototype.toString.call(t).match(/\[object\s([^]+)\]/)[1].toLowerCase()}function s(t,e){return 0<=t.indexOf(e)}function v(t){throw Error("[BubbleValidator] Error: ".concat(t))}function f(t){console.warn("[BubbleValidator] Warning: ".concat(t))}function h(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return String(t).replace(/\-([A-Za-z])/g,function(t,e){return e.toUpperCase()})}function d(t){return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return t=t.toUpperCase(),s(i,t)}(t.tagName)?"INPUT"===(e=t).tagName.toUpperCase()&&["checkbox","radio"].includes(e.type)?l.CHECKRADIO:l.COMMONFORM:l.NONFORM;var e}function m(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=t.getAttribute("name")||t.getAttribute("data-name");return e&&!i&&v('You must specify a "name" attribute for the validation field'),i}function $(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=null,r=t.data.directives,a=!0,o=!1,l=void 0;try{for(var d,c=r[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var u=d.value;if(u.name===e){n=u;break}}}catch(t){o=!0,l=t}finally{try{a||null==c.return||c.return()}finally{if(o)throw l}}return n&&i?n.modifiers[i]?n:null:n}function c(t,e){return!(void 0!==e||!s(n,t))||e}var p={};function y(t){var e=t.$name;t.$value===t.$origin?(t.pristine=!0,t.modified=!1):(t.pristine=!1,t.modified=!0,t.dirty=!0),this.checkValidity(e)}function b(t){t.untouched&&(t.untouched=!1,t.touched=!0),y.call(this,t)}function g(t,e,i,n){this.validation[t]||(this.$set(this.validation,t,Object.assign({},o)),Object.assign(this.validation[t],{$name:t,$element:e,$expression:n,$origin:i,$value:i,$oldVal:i}));var r=this.validation[t];(function(t){var e=t.$element;switch(d(e)){case l.CHECKRADIO:t.$watcher=this.$watch(t.$expression,b.bind(this,t));break;case l.COMMONFORM:p[t.$name]||(p[t.$name]=[]);var i=function(t){var e=t.$name;t.untouched&&(t.untouched=!1,t.touched=!0),this.checkValidity(e)}.bind(this,t);e.addEventListener("blur",i),p[t.$name].push(i),t.$watcher=this.$watch(t.$expression,y.bind(this,t));break;case l.NONFORM:t.$watcher=this.$watch(t.$expression,b.bind(this,t))}}).call(this,r),s(this.validation.$fields,t)||this.validation.$fields.push(t)}function O(){Object.assign(this.validation,{untouched:!0,touched:!0,modified:!1,dirty:!1,pristine:!0,invalid:!1,valid:!0});var i=this.validation;i.$fields.forEach(function(t){var e=i[t];!1===e.untouched&&(i.untouched=!1),!0===e.untouched&&(i.touched=!1),!0===e.modified&&(i.modified=!0),!0===e.dirty&&(i.dirty=!0),!1===e.pristine&&(i.pristine=!1),!0===e.invalid&&(i.invalid=!0),!1===e.valid&&(i.valid=!1)})}var x={ISO_DATE:/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,URL:/^[a-z]+:\/\/(?:[\w-]+\.)+[a-z]{2,6}.*$/i,EMAIL:/^[\w-\.]+@(?:[\w-]+\.)+[a-z]{2,6}$/i,NUMBER:/^[\d]+$/i,DATE:/^(\d{4})-(\d{2})-(\d{2})$/,TIME:/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/},w={required:function(t,e){return"false"===e||!e||("array"===r(t)?0<t.length:"object"===r(t)?0<Object.keys(t).length:0===t||!!t)},type:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=x[e.toUpperCase()];return i?i.test(t):(f('v-type="'.concat(e,'" does not match any rules so it will be ignored')),!0)},length:function(t,e){return String(t).length===parseInt(e)},minLength:function(t,e){return String(t).length>=parseInt(e)},maxLength:function(t,e){return String(t).length<=parseInt(e)},min:function(t,e){return e=parseFloat(e),!!isNaN(e)||(null==t||""===t||e<=+t)},max:function(t,e){return e=parseFloat(e),!!isNaN(e)||(null==t||""===t||+t<=e)},pattern:function(t,e){return"string"==typeof e&&(e=new RegExp(e)),e.test(t||"")},custom:function(t,e){return e}},N={required:1,type:2,length:3,minLength:4,maxLength:5,min:6,max:7,pattern:100,custom:200};function M(t){s(e,t)&&v('Name "'.concat(t,'" is a preserved word, please use other field names instead.'))}function E(t,e,i){var n,r,a=null,o=h(e.name),l="model"===o&&e.modifiers.validator||"validator"===o?e:((r=$(n=i,"model","validator"))||(r=$(n,"validator")),r);if(!l)return s(u,o)&&(a=m(t),f('Field "'.concat(a,"\" lacks of '.validator' modifier for form elements or 'v-validator' directive\n")+"for non-form elements, all validation rules will be ignore.")),!1;M(a=a||m(t));var d=i.context,c=d.validation[a];return"model"===o&&c&&c.$name&&t!==c.$element&&v("Duplicated validation field name: ".concat(a)),c||g.call(d,a,t,l.value,l.expression),!0}function C(t,e,i){var n=i.context,r=m(t,!1);if(r){M(r);var a=n.validation[r];a.$inited&&e.value===e.oldValue||(a.$oldVal=e.oldValue,a.$value=e.value,a.$inited||(a.$inited=!0))}}function R(t,e,i){var n=m(t,!1);if(n){var r=i.context;(function(t){var e=this.validation,i=e.$fields.indexOf(t);if(!(i<0)){e.$fields.splice(i,1);var n=e[t],r=n.$element,a=n.$watcher,o=n.$related;"function"==typeof a&&a(),"function"==typeof o&&o(),d(r)===l.COMMONFORM&&(p[n.$name].forEach(function(t){r.removeEventListener("blur",t)}),p[n.$name]=null),this.$delete(e,t),O.call(this)}}).call(r,n)}}function j(){return{bind:function(t,e,i,n){if(E(t,e,i)){var r=i.context,a=h(e.name),o=m(t),l=c(a,e.value);(function(t,e){var i=this.validation[t],n=i.$handlers=i.$handlers||[],r=n.map(function(t){return t.$directive}),a=e.$directive;s(r,a)||(this.$set(i,a,!1),n.push(e),n.sort(function(t,e){return t.$priority-e.$priority}))}).call(r,o,{$priority:N[a],$directive:a,$directiveVal:l,$handler:w[a]})}},update:function(t,e,i){var n=i.context,r=h(e.name),a=m(t),o=function(t,e){var i=null,n=!0,r=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var d=o.value;if(d.$directive===e){i=d;break}}}catch(t){r=!0,a=t}finally{try{n||null==l.return||l.return()}finally{if(r)throw a}}return i}(n.validation[a].$handlers,r);o&&(o.$directiveVal=c(r,e.value))}}}function S(t){var e=t.directive("model");t.directive("model",function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(t){a(e,t,i[t])})}return e}({},e,{bind:E,componentUpdated:C,unbind:R})),t.directive("validator",{bind:E,componentUpdated:C}),t.directive("related",{bind:function(t,e,i,n){if(E(t,e,i)){var r=i.context,a=m(t);(function(t,e){var i=this;t.$related=this.$watch(e,function(){i.checkValidity(t.$name)})}).call(r,r.validation[a],e.expression)}}});for(var i=Object.keys(w),n=0;n<i.length;n++){var r=i[n];t.directive(r,j())}}return{install:function(t,e){S(t),function(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};i=Object.assign({accessor:"v"},i),t.mixin({data:function(){return{validation:Object.assign({},o)}},created:function(){this.validation.$fields=[]},methods:(e={},a(e,i.accessor,function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"invalid",i=this.validation;return i[t]&&i[t][e]}),a(e,"resetValidation",function(){}),a(e,"checkValidity",function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(t){var i=this.validation[t],n=i.$value,r=i.$handlers||[],a=!(i.invalid=!1),o=!1,l=void 0;try{for(var d,c=r[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var u=d.value;i.invalid&&(i[u.$directive]=!1);var s=u.$handler(n,u.$directiveVal);i[u.$directive]=!s,s||(i.invalid=!0)}}catch(t){o=!0,l=t}finally{try{a||null==c.return||c.return()}finally{if(o)throw l}}i.valid=!i.invalid}else{var v=this.validation.$fields||[],f=!0,h=!1,m=void 0;try{for(var $,p=v[Symbol.iterator]();!(f=($=p.next()).done);f=!0){var y=$.value;this.checkValidity(y,!0)}}catch(t){h=!0,m=t}finally{try{f||null==p.return||p.return()}finally{if(h)throw m}}}!e&&O.call(this)}),e)})}(t,e)}}});
